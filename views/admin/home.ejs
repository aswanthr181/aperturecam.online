<%- include('../adminLayout/a_header.ejs') %>

  <nav class="navbar navbar-expand-xl">
    <div class="container h-100">
      <a class="navbar-brand" href="index.html">
        <h1 class="tm-site-title mb-0">Product Admin</h1>
      </a>
      <button class="navbar-toggler ml-auto mr-0" type="button" data-toggle="collapse"
        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
        aria-label="Toggle navigation">
        <i class="fas fa-bars tm-nav-icon"></i>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mx-auto h-100">
          <li class="nav-item">
            <a class="nav-link active" href="/admin/home">
              <i class="fas fa-tachometer-alt"></i> Dashboard
              <span class="sr-only">(current)</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/admin/userlist">
              <i class="far fa-file-alt"></i> userlist
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/admin/addproducts">
              <i class="fas fa-shopping-cart"></i> Products
            </a>
          </li>

          
          
          <li class="nav-item">
            <a class="nav-link" href="/admin/addcategory">
              category
            </a>
          </li>
          <li class="nav-item">
            
            <a class="nav-link" href="/admin/orderlist">
              <i class="fas fa-truck-fast"></i> orders
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/banner">
             
              Banner
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/coupon">
              Coupon
            </a>
          </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link d-block" href="/admin/logout">
              Admin, <b>Logout</b>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <h6>
    <%=adminData.email %>
  </h6>









  <!-- <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top px-3">
    <a class="navbar-brand" href="#"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <img src="/img/" alt="">
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/admin/home">Dashboard <span class="sr-only"></span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/admin/userlist">Users List</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/admin/addproducts">Add Product</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/admin/productlist">Products</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/admin/dashboard">Category</a>
        </li>



      </ul>
      <form class="form-inline my-2 my-lg-0 ms-auto" action="/admin/logout" method="">
        <button class="btn btn-outline-danger my-2 my-sm-0" type="submit">Log Out</button>
      </form>
    </div>
  </nav> -->




  <div class="container">
    <div class="row">
      <div class="col justify-content-between">
        <p class="text-white mt-5 mb-5 d-flex justify-content-between">Welcome back, Admin </p>

      </div>
    </div>
    <div class="container-fluid py-4">
      <a href="/admin/salesReport">sales report</a>
      <div class="row">
        
        <%if(dailySalesReport!=0){%>
          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card bg-dark">
              <div class="card-header p-3 pt-2 ">
                <div
                  class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                  <i class="material-icons opacity-10"></i>
                </div>
                <div class="text-end pt-1 text-white">
                  <p class="text-sm mb-0 text-capitalize text-white">Today's Sales</p>
                  <h4 class="mb-0">₹<%=dailySalesReport[0].totalSales%>
                  </h4>
                </div>
              </div>
              <hr class="dark horizontal my-0">
              <div class="card-footer p-3">
                <p class="mb-0 text-white"><span class="text-success text-sm font-weight-bolder">
                    <%=dailySalesReport[0].totalItemsSold%>
                  </span> Producs sold today</p>
              </div>



            </div>
          </div>
          <%}else{%>
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
              <div class="card bg-dark">
                <div class="card-header p-3 pt-2 ">
                  <div
                    class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10"></i>
                  </div>
                  <div class="text-end pt-1 text-white ">
                    <p class="text-sm mb-0 text-capitalize text-white ">Today's Sales</p>
                    <h4 class="mb-0">₹0</h4>
                  </div>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-3">
                  <p class="mb-0 text-white"><span class="text-success text-sm font-weight-bolder">0 </span> Products
                    sold today</p>
                </div>
              </div>
            </div>
            <%}%>
              <%if(weeklySalesReport!=0){%>
                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                  <div class="card text-white bg-dark">
                    <div class="card-header p-3 pt-2">
                      <div
                        class="icon icon-lg icon-shape bg-gradient-primary shadow-primary text-center border-radius-xl mt-n4 position-absolute">
                        <i class="material-icons opacity-10"></i>
                      </div>
                      <div class="text-end pt-1">
                        <p class="text-sm mb-0 text-capitalize">This week collection</p>
                        <h4 class="mb-0">₹ <%= weeklySalesReport[0].totalSales %>
                        </h4>
                      </div>
                    </div>
                    <hr class="dark horizontal my-0">
                    <div class="card-footer p-3">
                      <p class="mb-0"><span class="text-success text-sm font-weight-bolder">
                          <%= weeklySalesReport[0].totalItemsSold%>
                        </span> Products sold this week</p>
                    </div>
                  </div>
                </div>
                <%}else{%>
                  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card text-white bg-dark">
                      <div class="card-header p-3 pt-2">
                        <div
                          class="icon icon-lg icon-shape bg-gradient-primary shadow-primary text-center border-radius-xl mt-n4 position-absolute">
                          <i class="material-icons opacity-10"></i>
                        </div>
                        <div class="text-end pt-1">
                          <p class="text-sm mb-0 text-capitalize">This week collection</p>
                          <h4 class="mb-0">₹ 0
                          </h4>
                        </div>
                      </div>
                      <hr class="dark horizontal my-0">
                      <div class="card-footer p-3">
                        <p class="mb-0"><span class="text-success text-sm font-weight-bolder">
                            0
                          </span> Products sold this week</p>
                      </div>
                    </div>
                  </div>
                  <%}%>
                    <%if(yearlySalesReport!=0){%>
                      <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                        <div class="card text-white bg-dark">
                          <div class="card-header p-3 pt-2">
                            <div
                              class="icon icon-lg icon-shape bg-gradient-success shadow-success text-center border-radius-xl mt-n4 position-absolute">
                              <i class="material-icons opacity-10"></i>
                            </div>
                            <div class="text-end pt-1">
                              <p class="text-sm mb-0 text-capitalize">Yearly sales report</p>
                              <h4 class="mb-0">₹ <%= yearlySalesReport[0].totalSales%>
                              </h4>
                            </div>
                          </div>
                          <hr class="dark horizontal my-0">
                          <div class="card-footer p-3">
                            <p class="mb-0"><span class="text-success text-sm font-weight-bolder">
                                <%= yearlySalesReport[0].totalItemsSold %>
                              </span> Products sold this year</p>
                          </div>
                        </div>
                      </div>

                      <%}else{%>
                        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                          <div class="card text-white bg-dark">
                            <div class="card-header p-3 pt-2">
                              <div
                                class="icon icon-lg icon-shape bg-gradient-success shadow-success text-center border-radius-xl mt-n4 position-absolute">
                                <i class="material-icons opacity-10"></i>
                              </div>
                              <div class="text-end pt-1">
                                <p class="text-sm mb-0 text-capitalize">Yearly sales report</p>
                                <h4 class="mb-0">₹ 0
                                </h4>
                              </div>
                            </div>
                            <hr class="dark horizontal my-0">
                            <div class="card-footer p-3">
                              <p class="mb-0"><span class="text-danger text-sm font-weight-bolder">
                                  0
                                </span> Products sold this year</p>
                            </div>
                          </div>
                        </div>
                        <%}%>
                          <div class="col-xl-3 col-sm-6">
                            <div class="card text-white bg-dark">
                              <div class="card-header p-3 pt-2">
                                <div
                                  class="icon icon-lg icon-shape bg-gradient-info shadow-info text-center border-radius-xl mt-n4 position-absolute">
                                  <i class="material-icons opacity-10"></i>
                                </div>
                                <div class="text-end pt-1">
                                  <p class="text-sm mb-0 text-capitalize">Users</p>
                                  <h4 class="mb-0">
                                    <%=usersLength%>
                                  </h4>
                                </div>
                              </div>
                              <hr class="dark horizontal my-0">
                              <div class="card-footer p-3">
                                <p class="mb-0"><span class="text-success text-sm font-weight-bolder">50% </span> than
                                  previous month</p>
                              </div>
                            </div>
                          </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <div class="row tm-content-row">

      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 tm-block-col">
        <div class="tm-bg tm-block" style="background-color: rgb(42, 55, 67);">
          <h2 class="tm-block-title">Daily Sales</h2>
          <canvas id="lineChart"></canvas>
          <button class="" style="background: none; border: none; position: relative; bottom: 20px;"
            onclick="downloadlineChart()"><i class="bi bi-download"></i></button>
        </div>

      </div>




      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 tm-block-col">
        <div class="tm-bg-primary-dark tm-block" style="background-color: rgb(42, 55, 67);">
          <h2 class="tm-block-title">Total Payments</h2>
          <canvas style="margin: 0 auto;" id="piechart"></canvas>
          <button class="" style="background: none; border: none;" onclick="downloadpieChart()"><i
              class="bi bi-download"></i></button>
        </div>


        <script>
          var orders = '<%= JSON.stringify(order) %>';
          const dataa = JSON.parse(orders.replace(/&#34;/g, '"'));

          const ctxx = document.getElementById('piechart');
          var myChart = new Chart(ctxx, {
            type: 'pie',
            data: {
              labels: ['COD', 'razorpay','wallet'],
              datasets: [{
                label: 'Mode of Payment',
                data: [dataa[0].codCount, dataa[0].razorpayCount,dataa[0].walletCount],
                backgroundColor: [
                  'teal',
                  'grey',
                  'brown'
                ],

                borderWidth: 1
              }]
            },
            options: {
              // ...
            }
          });
          function downloadpieChart() {
            var chartCanvas = document.getElementById('piechart');
            var dataURL = chartCanvas.toDataURL('image/png');
            var link = document.createElement('a');
            link.download = 'chart.png';
            link.href = dataURL;
            link.click();
          }
        </script>


      </div>

    </div>



  </div>
  </div>
  </div>
  </body>
  <%if(message){%>
    <script>
      new Swal({
        title: "Success",
        text: "<%=message%>",
        icon: "success",
        showConfirmButton: false,
        timer: 2000
      });
    </script>

    <%}%>

      <script>

        const daily = '<%= JSON.stringify(dailySalesDetails) %>';
        const data = JSON.parse(daily.replace(/&#34;/g, '"'));
        // Create an array of days in the current month
        const currentDate = new Date();
        const currentDay = currentDate.getDate();
        const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
        const daysArray = Array.from({ length: daysInMonth }, (_, i) => i);

        const totalSalesArray = daysArray.map(day => {
          const matchingData = data.find(d => new Date(d.date).getDate() === day);
          console.log(matchingData);
          if (day <= currentDay) {
            return matchingData ? matchingData.totalSales : 0;
          } else {
            return null;
          }
        });
        console.log(totalSalesArray);


        const ctx = document.getElementById('lineChart');
        ctx.width = 600;
        ctx.height = 200;
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: daysArray,
            datasets: [{
              label: 'Total Sales',
              data: totalSalesArray,
              borderWidth: 2,
              borderColor: 'green',
              backgroundColor: 'red',
              tension: 0.4
            }]

          }, options: {
            plugins: {
              title: {
                display: true,
                text: 'Daily Sales',
                font: {
                  size: 18,
                  weight: 'bold',
                }
              },
              legend: {
                labels: {
                  font: {
                    color: 'white',
                    weight: 'bold',
                  }
                }
              }
            }
          },

          options: {
            scales: {
              y: {
                ticks: {
                  color: 'white',
                  beginAtZero: true,
                  stepSize: 1000,
                  max: 10000,
                  font: {
                    size: 14,
                    color: '#555'
                  }
                },

                title: {
                  display: true,
                  text: 'Daily Sales',
                  color: 'red',


                },
                grid: {
                  color: 'grey'
                }
              },
              x: {
                ticks: {
                  color: 'white',
                  font: {
                    size: 14,

                  }
                },
                title: {
                  display: true,
                  text: 'Daily Sales',
                  color: 'red',
                },
                grid: {
                  color: 'grey',
                  display: true
                }
              }
            }
          }
        });

        function downloadlineChart() {
          var chartCanvas = document.getElementById('lineChart');
          var dataURL = chartCanvas.toDataURL('image/png');
          var link = document.createElement('a');
          link.download = 'chart.png';
          link.href = dataURL;
          link.click();
        }



      </script>
        
      <%- include('../adminLayout/a_footer.ejs') %>